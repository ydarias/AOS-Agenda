<!DOCTYPE html>
<html>
<head>
    <title>WeEvent | Events list</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">

    <style>
        body {
            padding: 10px 15px;
        }

        hr.element-separator {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <ul id="breadcrumbAttachmentPoint" class="breadcrumb">
      <li class="active">Events</li>
    </ul>

    <div id="messagesAttachmentPoint"></div>

    <div id="contentAttachmentPoint"></div>

    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery-min.js"></script>
    <script src="js/underscore-min.js"></script>
    <script src="js/backbone-min.js"></script>
    <script src="js/handlebars.js"></script>
    <script src="templates/templates.js"></script>
    <script>
        window.App = window.App || {};

        App.template = function (name, data) {
            return JST[name](data);
        }

        var WeEvent = WeEvent || {};

        WeEvent.Configuration = WeEvent.Configuration || {};
        (function() {
            WeEvent.Configuration.baseURL = 'http://localhost:8080/api';
            WeEvent.Configuration.timeout = 30000;
        })();

        WeEvent.UI = WeEvent.UI || {};

        WeEvent.UI.ListEventsView = Backbone.View.extend({

            render: function() {
                var html = App.template("listEvents", {});
                this.$el.html(html);

                return this;
            }

        });

        (function() {
            function disableAddEventButton() {
                $('#add-event-button').addClass('disabled');
            }

            function enableAddEventButton() {
                $('#add-event-button').removeClass('disabled');
            }

            function cleanAddEventForm() {
                $('#add-event-form form')[0].reset();
            }

            function displayAddEvent() {
                disableAddEventButton();
                $('#add-event-form').show(500);
            }

            function hideAddEvent() {
                cleanAddEventForm();
                $('#add-event-form').hide(500, enableAddEventButton);
            }

            function refreshEvents() {

            }

            function showSuccessMessage(message) {
                var html = '<div class="alert alert-success">' +
                      '<button type="button" class="close" data-dismiss="alert">&times;</button>' +
                      message +
                    '</div>';
                $('#messagesAttachmentPoint').html(html);
            }

            function showErrorMessage(message) {
                var html = '<div class="alert alert-error">' +
                      '<button type="button" class="close" data-dismiss="alert">&times;</button>' +
                      message +
                    '</div>';
                $('#messagesAttachmentPoint').html(html);
            }

            function createEvent() {
                var event = {
                    name: $('#eventName').val(),
                    description: $('#eventDescription').val()
                }

                var data = JSON.stringify(event);

                $.ajax({
                    url: WeEvent.Configuration.baseURL + '/events',
                    type: 'POST',
                    timeout: WeEvent.Configuration.timeout,
                    contentType: 'application/json',
                    data: data,
                    success: function() {
                        hideAddEvent();
                        showSuccessMessage('Nice!, your event was created.')
                    },
                    error: function() {
                        showErrorMessage('Oopss, we are embarrased something is wrong :-(');
                    }
                });
            }

            WeEvent.UI.displayAddEvent = displayAddEvent;
            WeEvent.UI.hideAddEvent = hideAddEvent;
            WeEvent.UI.refreshEvents = refreshEvents;
            WeEvent.UI.createEvent = createEvent;
        })();

        var listEventsView = new WeEvent.UI.ListEventsView({
            el: '#contentAttachmentPoint'
        });
        listEventsView.render();
    </script>
</body>
</html>